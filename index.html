<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MiraRoma</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/css/ol.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        #header {
            background-color: rgba(255, 255, 255, 0) !important;
            height: 50px;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }
        
        #content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        #map-container {
            flex: 0 0 100%;
            position: relative;
            overflow: hidden;
        }
        
        #map {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /*   pER SPAZIO PUBBLICITARIO, ridurre map-container a 70%      
        #ad-space {
            flex: 0 0 30%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
        } */
        
        .custom-icon {
            font-size: 24px;
        }
        
        .audio-btn,
        .directions-btn {
            margin-left: 10px;
            width: 50px;
            height: 50px;
            flex-shrink: 0;
        }
        
        .modal-dialog {
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            z-index: 1020;
            /* Assicurati che il titolo stia sopra il contenuto durante lo scorrimento */
            background-color: white;
            /* Mantieni lo sfondo visibile quando √® fisso */
        }
        
        .modal-body {
            overflow-y: auto;
            /* Attiva lo scroll solo sul corpo */
        }
        
        .modal-content {
            max-height: calc(90vh - 60px);
            overflow-y: auto;
        }
        
        .locate-control {
            position: absolute;
            bottom: 35px;
            right: 10px;
        }
        
        .locate-control button {
            background-color: white;
            border: 2px solid #000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: absolute;
            bottom: 35%;
            /* Spostato in basso a destra */
            right: 2%;
            z-index: 1000;
        }
        
        .locate-control button i {
            color: #000;
            font-size: 20px;
        }
    </style>
</head>

<body>
    <div id="header" class="position-fixed top-0 w-100 bg-light p-2 d-flex justify-content-between align-items-center">
        <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <span id="headerTitle">Mira Roma</span>
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#progettoModal">Progetto</a></li>
                <li><a class="dropdown-item" href="https://www.paypal.com/donate/?hosted_button_id=L5R8GJK2L85VC" target="_blank">Sostienici ‚ù§Ô∏è</a></li>
                <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy</a></li>
            </ul>
        </div>
        <div class="dropdown">
            <button id="languageSelector" class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <span id="languageSelectorText">üáÆüáπ Italiano</span>
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" data-lang="it">üáÆüáπ Italiano</a></li>
                <li><a class="dropdown-item" data-lang="en">üá¨üáß English</a></li>
                <li><a class="dropdown-item" data-lang="fr">üá´üá∑ Fran√ßais</a></li>
                <li><a class="dropdown-item" data-lang="es">üá™üá∏ Espa√±ol</a></li>
                <!-- <li><a class="dropdown-item" data-lang="lat">üá™Latino</a></li> -->
            </ul>
        </div>
    </div>

    <div id="content-wrapper">
        <div id="map-container">
            <div id="map"></div>
            <div class="locate-control">
                <button id="locateButton">
                    <i class="fas fa-crosshairs"></i>
                </button>
            </div>
        </div>
        <!-- pubblicit√† -->
        <div id="ad-space">
            <p></p>
        </div>
    </div>
    <!-- bottone destro Miraroma oscurato -->
    <div class="modal fade" id="progettoModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><strong>MiraRoma</strong></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="progettoContent">
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="privacyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Privacy Policy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Ultimo aggiornamento:</strong> 23/10/2024</p>

                    <h6>Introduzione</h6>
                    <p>
                        La presente Privacy Policy descrive come raccogliamo, utilizziamo e proteggiamo i dati personali degli utenti nell'uso dell'applicazione "MiraRoma" ("l'Applicazione"). MiraRoma si impegna a rispettare la privacy degli utenti e a proteggere i loro dati
                        personali in conformit√† con il Regolamento Generale sulla Protezione dei Dati (GDPR) e la normativa italiana sulla protezione dei dati personali (D.Lgs. 196/2003, "Codice della Privacy").
                    </p>

                    <h6>1. Informazioni che raccogliamo</h6>
                    <p>
                        MiraRoma non raccoglie, conserva o condivide dati personali degli utenti. Tuttavia, l'Applicazione pu√≤ accedere temporaneamente alla posizione corrente dell'utente per fornire funzionalit√† specifiche, come la visualizzazione di contenuti o servizi personalizzati
                        in base alla posizione. Questi dati di posizione non vengono conservati, condivisi o utilizzati per scopi commerciali.
                    </p>

                    <h6>2. Uso dei dati di posizione</h6>
                    <p>
                        I dati di posizione degli utenti vengono utilizzati esclusivamente per fornire servizi in tempo reale all'interno dell'Applicazione, come la visualizzazione della posizione corrente su una mappa o l'individuazione di punti di interesse nelle vicinanze.
                        Questi dati vengono trattati esclusivamente localmente sul dispositivo dell'utente e non vengono trasmessi a server esterni o a terze parti.
                    </p>

                    <h6>3. Sicurezza</h6>
                    <p>
                        MiraRoma adotta misure tecniche e organizzative adeguate per proteggere i dati di posizione degli utenti durante il loro utilizzo temporaneo, impedendo accessi non autorizzati, perdite o usi impropri.
                    </p>

                    <h6>4. Diritti degli utenti</h6>
                    <p>
                        Gli utenti hanno il diritto di:
                        <ul>
                            <li>Disattivare la condivisione della posizione tramite le impostazioni del dispositivo.</li>
                            <li>Richiedere ulteriori informazioni su come i loro dati di posizione vengono utilizzati all'interno dell'Applicazione.</li>
                        </ul>
                    </p>

                    <h6>5. Modifiche alla presente Privacy Policy</h6>
                    <p>
                        MiraRoma si riserva il diritto di aggiornare o modificare questa Privacy Policy in qualsiasi momento. In caso di modifiche sostanziali, informeremo gli utenti tramite notifiche all'interno dell'Applicazione o attraverso il nostro sito web.
                    </p>

                    <h6>6. Contatti</h6>
                    <p>
                        Per qualsiasi domanda o chiarimento riguardo questa Privacy Policy, √® possibile contattarci all'indirizzo email: <a href="mailto:gmt91@protonmail.com">gmt91@protonmail.com</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="poiModal" tabindex="-1" aria-labelledby="poiModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="poiModalLabel">POI Modal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- l'img viene generata nella funzione showModal -->
                    <p id="poiModalDescription"></p>
                </div>
                <div class="modal-footer d-flex justify-content-start">
                    <!-- Pulsanti aggiunti nel footer -->
                    <button class="btn btn-lg btn-outline-secondary me-2" style="width: 40px; height: 40px; padding: 0; display: flex; justify-content: center; align-items: center;">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="btn btn-lg btn-outline-primary" style="width: 40px; height: 40px; padding: 0; display: flex; justify-content: center; align-items: center;" id="routeButton">
                        <i class="fas fa-route"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <footer id="sticky-footer" class="py-4 bg-dark text-white-50">
        <div class="container text-center">
            <p>¬© 2024 Copyright: <a href="" class="text-decoration-none text-white">Giovanni Tidei</a> </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/build/ol.js"></script>

    <script>
        // Coordinate di Roma
        let rome = ol.proj.fromLonLat([12.474601, 41.897344]);
        // Creazione della mappa
        let map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM({
                        url: 'https://cartodb-basemaps-{a-d}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png'
                    })
                })
            ],
            view: new ol.View({
                center: rome,
                zoom: 14
            }),
            controls: ol.control.defaults({
                zoom: false,
                attribution: true
            })
        });

        let userPositionMarker;
        let userPositionFeature;
        let speechSynthesis = window.speechSynthesis;
        let speechUtterance = null;
        let isPlaying = false;
        let currentLang = 'it';
        let currentLanguage = 'it';
        let loadedPOIs = new Set(); // Per tenere traccia dei POI gi√† caricati
        //nn serve
        // function changeLanguage(lang) {
        //     currentLanguage = lang;
        // }

        // Funzione per richiedere la geolocalizzazione
        function requestGeolocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        var coords = ol.proj.fromLonLat([position.coords.longitude, position.coords.latitude]);
                        map.getView().setCenter(coords);
                        map.getView().setZoom(16);
                        addUserPositionMarker(coords);
                    },
                    function(error) {
                        console.error('Errore nella geolocalizzazione:', error);
                    }, {
                        enableHighAccuracy: true
                    }
                );
            } else {
                console.error('Il browser non supporta la geolocalizzazione.');
            }
        }

        function addUserPositionMarker(coords) {
            if (!userPositionFeature) {
                userPositionFeature = new ol.Feature({
                    geometry: new ol.geom.Point(coords)
                });

                var userPositionStyle = new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: 8,
                        fill: new ol.style.Fill({
                            color: 'blue'
                        }),
                        stroke: new ol.style.Stroke({
                            color: 'white',
                            width: 4
                        })
                    })
                });

                userPositionMarker = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: [userPositionFeature]
                    }),
                    style: userPositionStyle
                });

                map.addLayer(userPositionMarker);
            } else {
                userPositionFeature.getGeometry().setCoordinates(coords);
            }
        }

        var locateButton = document.getElementById('locateButton');
        locateButton.addEventListener('click', function() {
            requestGeolocation();
        });

        setInterval(function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        var coords = ol.proj.fromLonLat([position.coords.longitude, position.coords.latitude]);
                        addUserPositionMarker(coords);
                    },
                    function(error) {
                        console.error('Errore nell\'aggiornamento della posizione:', error);
                    }, {
                        enableHighAccuracy: true
                    }
                );
            }
        }, 2000);

        // Funzione modificata per caricare i POI in base alla viewport
        function loadPOIData() {
            const jsonUrl = 'punti_interesse.json';
            const currentExtent = map.getView().calculateExtent(map.getSize());
            const bufferedExtent = ol.extent.buffer(currentExtent, ol.extent.getWidth(currentExtent) * 0.1);

            fetch(jsonUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Errore nel caricamento del file JSON: ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    data.forEach(item => {
                        const coords = ol.proj.fromLonLat([parseFloat(item.lon), parseFloat(item.lat)]);
                        const poiId = `${item.lat}-${item.lon}`; // Identificatore unico per ogni POI

                        // Verifica se il POI √® nella viewport e non √® gi√† stato caricato
                        if (ol.extent.containsCoordinate(bufferedExtent, coords) && !loadedPOIs.has(poiId)) {
                            const poi = {
                                name: {
                                    it: item.name,
                                    en: item.name_en,
                                    fr: item.name_fr,
                                    es: item.name_es
                                },
                                category: item.category,
                                lat: parseFloat(item.lat),
                                lng: parseFloat(item.lon),
                                description: {
                                    it: item.description_it,
                                    en: item.description_en,
                                    fr: item.description_fr,
                                    es: item.description_es,
                                    lat: item.description_lat
                                },
                                img: item.img,
                                imgsrc: item.imgsrc,
                            };
                            createMarker(poi);
                            loadedPOIs.add(poiId); // Aggiungi il POI alla lista dei caricati
                        }
                    });
                })
                .catch(error => {
                    console.error('Errore nel caricamento dei dati JSON:', error);
                });
        }

        function createMarker(poi) {
            const coords = ol.proj.fromLonLat([poi.lng, poi.lat]);
            const marker = new ol.Feature({
                geometry: new ol.geom.Point(coords),
                name: poi.name,
                description: poi.description,
                category: poi.category,
                lat: poi.lat,
                lng: poi.lng
            });

            const markerStyle = new ol.style.Style({
                image: new ol.style.Icon({
                    src: `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><text x="12" y="20" font-family="Arial" font-size="20" fill="black" text-anchor="middle">${getIconForCategory(poi.category)}</text></svg>`,
                    scale: 1.8
                })
            });

            marker.setStyle(markerStyle);

            const vectorSource = new ol.source.Vector({
                features: [marker]
            });

            const vectorLayer = new ol.layer.Vector({
                source: vectorSource
            });

            map.addLayer(vectorLayer);

            map.on('click', function(evt) {
                map.forEachFeatureAtPixel(evt.pixel, function(feature) {
                    if (feature === marker) {
                        showModal(poi);
                    }
                });
            });
        }
        //associa emoj ai marker in base a categoria
        function getIconForCategory(category) {
            return {
                monumenti: 'üèõÔ∏è',
                chiese: '‚úùÔ∏è',
                edifici: 'üè¢',
                varie: 'üëÅÔ∏è',
                fontane: '‚õ≤',
                statue: 'üóø',
            }[category] || '';
        }

        function showModal(poi) {
            const modal = document.getElementById('poiModal');
            const modalTitle = document.getElementById('poiModalLabel');
            const modalBody = document.getElementById('poiModalDescription');
            const routeButton = document.getElementById('routeButton');
            let animationInterval;
            let currentUtterance = null;
            let isPlaying = false;

            // Resetta qualsiasi sintesi vocale in corso
            if (currentUtterance) {
                speechSynthesis.cancel();
                isPlaying = false;
                clearInterval(animationInterval);
            }

            // Funzione per creare l'animazione delle emoji
            function createSpeakingAnimation() {
                const emojis = ['üòÄ', 'üòÆ', 'üòê', 'üòØ', 'üòë', 'üòØ', 'üôÇ', 'üòÄ', 'üôÇ', 'üòÆ', 'üòê', 'üòÄ', 'üòÆ'];
                let currentIndex = 0;

                const modalFooter = document.querySelector('#poiModal .modal-footer');
                const emojiContainer = document.createElement('p');
                emojiContainer.style.fontSize = '38px';
                emojiContainer.style.display = 'inline-block';
                emojiContainer.style.marginLeft = 'auto';
                modalFooter.appendChild(emojiContainer);

                return {
                    start: () => {
                        if (!document.body.contains(emojiContainer)) {
                            modalFooter.appendChild(emojiContainer);
                        }
                        emojiContainer.style.display = 'inline-block';
                        animationInterval = setInterval(() => {
                            emojiContainer.textContent = emojis[currentIndex];
                            currentIndex = (currentIndex + 1) % emojis.length;
                        }, 220);
                    },
                    stop: () => {
                        clearInterval(animationInterval);
                        emojiContainer.style.display = 'none';
                    }
                };
            }

            // Configura il contenuto del modal
            modalTitle.textContent = poi.name[currentLanguage] || poi.name.it;
            modalBody.innerHTML = '';

            const imgElement = document.createElement('img');
            imgElement.src = poi.img;
            imgElement.alt = poi.name[currentLanguage] || poi.name.it;
            imgElement.classList.add('img-fluid');
            modalBody.appendChild(imgElement);

            const imgSrcDiv = document.createElement('div');
            imgSrcDiv.innerHTML = poi.imgsrc;
            imgSrcDiv.style.fontSize = '0.5em';
            imgSrcDiv.style.marginTop = '1em';
            imgSrcDiv.style.marginBottom = '0.1em';
            imgSrcDiv.style.wordWrap = 'break-word';
            imgSrcDiv.style.overflowWrap = 'break-word';
            imgSrcDiv.style.maxWidth = '100%';
            modalBody.appendChild(imgSrcDiv);

            const separator = document.createElement('hr');
            modalBody.appendChild(separator);

            const descriptionParagraph = document.createElement('p');
            descriptionParagraph.textContent = poi.description[currentLanguage] || poi.description.it;
            modalBody.appendChild(descriptionParagraph);

            const speakingAnimation = createSpeakingAnimation();

            // Configura il pulsante audio
            const audioBtn = document.querySelector('#poiModal .modal-footer .btn-outline-secondary');
            audioBtn.innerHTML = '<i class="fas fa-play"></i>';

            function createNewUtterance() {
                const utterance = new SpeechSynthesisUtterance(poi.description[currentLanguage] || poi.description.it);
                const langMap = {
                    'it': 'it-IT',
                    'en': 'en-GB',
                    'fr': 'fr-FR',
                    'es': 'es-ES',
                    'lat': 'it'
                };
                utterance.lang = langMap[currentLanguage];

                utterance.onend = function() {
                    audioBtn.innerHTML = '<i class="fas fa-play"></i>';
                    isPlaying = false;
                    speakingAnimation.stop();
                    currentUtterance = null;
                };

                return utterance;
            }

            // Gestione del pulsante audio
            audioBtn.onclick = function() {
                if (isPlaying) {
                    // Se sta riproducendo, ferma tutto
                    speechSynthesis.cancel();
                    speakingAnimation.stop();
                    audioBtn.innerHTML = '<i class="fas fa-play"></i>';
                    isPlaying = false;
                    currentUtterance = null;
                } else {
                    // Se non sta riproducendo, inizia una nuova utterance
                    if (currentUtterance) {
                        speechSynthesis.cancel();
                    }
                    currentUtterance = createNewUtterance();
                    speechSynthesis.speak(currentUtterance);
                    speakingAnimation.start();
                    audioBtn.innerHTML = '<i class="fas fa-stop"></i>';
                    isPlaying = true;
                }
            };

            routeButton.onclick = function() {
                openGoogleMaps(poi.lat, poi.lng);
            };
            routeButton.style.padding = '10px 20px';

            // Gestione chiusura modal
            modal.addEventListener('hidden.bs.modal', function() {
                if (currentUtterance) {
                    speechSynthesis.cancel();
                    audioBtn.innerHTML = '<i class="fas fa-play"></i>';
                    isPlaying = false;
                    speakingAnimation.stop();
                    currentUtterance = null;
                }
            });

            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
        }

        // Definisci le traduzioni per ogni lingua
        const translations = {
            it: {
                title: "MiraRoma",
                content: `
            <strong>MiraRoma</strong> come mai prima d'ora! Una mappa interattiva che ti guider√† tra i tesori storici e artistici della Capitale.
            Immagina di passeggiare tra le strade acciottolate, mentre un curatore virtuale ti racconta storie affascinanti su monumenti, statue, palazzi e fontane.
            Non solo avrai accesso a informazioni dettagliate su ogni punto di interesse, ma anche aneddoti divertenti e curiosit√† che renderanno ogni visita un‚Äôesperienza indimenticabile.
            Che tu sia un turista in cerca di avventure o un romano desideroso di riscoprire la propria citt√†, <strong>MiraRoma</strong> ti accompagner√† nelle bellezze senza tempo di Roma.
        `
            },
            en: {
                title: "MiraRoma",
                content: `
            Discover Rome like never before! <strong>MiraRoma</strong> is an interactive map that will guide you through the historical and artistic treasures of the Eternal City.
            Imagine strolling through the cobblestone streets while a virtual curator shares fascinating stories about monuments, statues, palaces, and fountains.
            Not only will you have access to detailed information about each point of interest, but also fun anecdotes and curiosities that will make each visit unforgettable.
            Whether you're a tourist looking for adventures or a Roman wanting to rediscover your city, <strong>MiraRoma</strong> will accompany you through the timeless beauty of Rome.
        `
            },
            fr: {
                title: "MiraRoma",
                content: `
            D√©couvrez Rome comme jamais auparavant ! <strong>MiraRoma</strong> est une carte interactive qui vous guidera √† travers les tr√©sors historiques et artistiques de la Capitale.
            Imaginez-vous d√©ambulant dans les rues pav√©es pendant qu‚Äôun curateur virtuel vous raconte des histoires fascinantes sur les monuments, statues, palais et fontaines.
            Non seulement vous aurez acc√®s √† des informations d√©taill√©es sur chaque point d‚Äôint√©r√™t, mais aussi √† des anecdotes amusantes et des curiosit√©s qui rendront chaque visite inoubliable.
            Que vous soyez un touriste en qu√™te d‚Äôaventures ou un Romain d√©sireux de red√©couvrir votre ville, <strong>MiraRoma</strong> vous accompagnera √† travers la beaut√© intemporelle de Rome.
        `
            }
        };

        // Funzione per cambiare la lingua
        function changeLanguage(lang) {
            currentLanguage = lang; // Aggiorna la lingua corrente

            // Aggiorna il modal del progetto
            const projectTranslation = translations[lang];
            if (projectTranslation) {
                document.querySelector('#progettoModal .modal-title').innerHTML = projectTranslation.title;
                document.getElementById('progettoContent').innerHTML = projectTranslation.content;
            }

            // Se c'√® un modal aperto per i POI, aggiorna il contenuto
            const poiModal = document.getElementById('poiModal');
            if (poiModal.classList.contains('show')) {
                const currentPoiTitle = document.getElementById('poiModalLabel').textContent;
                const currentPoi = findPoiByTitle(currentPoiTitle); // Dovrai implementare questa funzione

                if (currentPoi) {
                    // Aggiorna il contenuto del modal nella nuova lingua
                    document.getElementById('poiModalLabel').textContent = currentPoi.name[lang] || currentPoi.name.it;

                    // Se c'√® una riproduzione audio in corso, fermala
                    if (speechUtterance && isPlaying) {
                        speechSynthesis.cancel();
                        document.querySelector('#poiModal .modal-footer .btn-outline-secondary').innerHTML =
                            '<i class="fas fa-play"></i>';
                        isPlaying = false;
                    }
                }
            }
        }

        // Gestione del selettore lingua nel menu
        document.querySelectorAll('.dropdown-item[data-lang]').forEach(item => {
            item.addEventListener('click', function(event) {
                const selectedLang = this.dataset.lang; // Lingua selezionata (it, en, fr, ecc.)
                const selectedText = this.textContent; // Testo del pulsante selezionato (Italiano, English, Fran√ßais, ecc.)

                if (selectedLang) {
                    // Aggiorna il testo del selettore visibile
                    document.getElementById('languageSelectorText').textContent = selectedText;

                    // Cambia la lingua e aggiorna il contenuto del modal
                    changeLanguage(selectedLang);
                }
            });
        });

        // Imposta il contenuto iniziale in italiano
        changeLanguage('it'); // Quando la pagina viene caricata, il contenuto sar√† in italiano


        function openGoogleMaps(lat, lng) {
            const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
            window.open(url, '_blank');
        }

        // Aggiungi listener per il movimento della mappa
        map.on('moveend', function() {
            loadPOIData();
        });

        // Inizializza la mappa caricando i POI iniziali
        loadPOIData();

        // Abilita la rotazione della mappa
        map.addInteraction(new ol.interaction.DragRotate({
            condition: ol.events.condition.altKeyOnly
        }));

        // Aggiungi l'interazione di trascinamento per dispositivi touch
        map.addInteraction(new ol.interaction.DragPan());

        // Aggiungi l'interazione di rotazione con due dita per dispositivi touch
        map.addInteraction(new ol.interaction.Rotate({
            condition: ol.events.condition.touch
        }));

        // Inizializza la geolocalizzazione
        requestGeolocation();
    </script>
</body>

</html>